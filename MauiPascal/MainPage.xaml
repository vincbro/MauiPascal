<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:MauiPascal.Models"
             xmlns:converters="clr-namespace:MauiPascal.Converters"
             x:Class="MauiPascal.MainPage"
             BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Black}}"
             Title="Plan Your Journey">

    <ContentPage.Resources>
        <converters:IsNullConverter x:Key="IsNullConverter" />
        <converters:IsNotNullConverter x:Key="IsNotNullConverter" />
        <converters:BoolToOpacityConverter x:Key="BoolToOpacityConverter" />
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">

            <!-- Journey Card -->
            <Border Padding="16"
                    Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    StrokeThickness="1"
                    BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="Black" Offset="0,2" Radius="8" Opacity="{AppThemeBinding Light=0.08, Dark=0}" />
                </Border.Shadow>

                <VerticalStackLayout Spacing="16">
                    <!-- Header -->
                    <Label Text="Plan Your Journey" 
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />

                    <!-- From Station -->
                    <VerticalStackLayout Spacing="8">
                        <Label Text="From" 
                               FontSize="12"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />
                        
                        <Border Padding="12,10"
                                Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
                                StrokeThickness="1"
                                BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}"
                                IsVisible="{Binding FromArea, Converter={StaticResource IsNullConverter}}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>
                            <Entry x:Name="From"
                                   Placeholder="Search for a station..."
                                   TextChanged="From_TextChanged"
                                   Focused="From_Focused"
                                   FontSize="15"
                                   BackgroundColor="Transparent" />
                        </Border>

                        <Border Padding="12"
                                Stroke="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                StrokeThickness="2"
                                BackgroundColor="{AppThemeBinding Light=#F5F3FF, Dark=#1A1625}"
                                IsVisible="{Binding FromArea, Converter={StaticResource IsNotNullConverter}}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>
                            <Grid ColumnDefinitions="*, Auto">
                                <VerticalStackLayout Grid.Column="0" Spacing="2">
                                    <Label Text="{Binding FromArea.Name}" 
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                                    <Label Text="Departure station" 
                                           FontSize="11"
                                           TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                                </VerticalStackLayout>
                                <Button Grid.Column="1"
                                        Text="✕"
                                        FontSize="18"
                                        Clicked="RemoveFrom_Clicked"
                                        WidthRequest="36"
                                        HeightRequest="36"
                                        Padding="0"
                                        CornerRadius="18"
                                        BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                                        TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}" />
                            </Grid>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Swap Button -->
                    <Border Padding="8"
                            BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                            StrokeThickness="0"
                            HorizontalOptions="Center"
                            WidthRequest="40"
                            HeightRequest="40"
                            Opacity="{Binding CanSearch, Converter={StaticResource BoolToOpacityConverter}}"
                            IsEnabled="{Binding CanSearch}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="20" />
                        </Border.StrokeShape>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="SwapStations_Clicked" />
                        </Border.GestureRecognizers>
                        <Label Text="⇅" 
                               FontSize="20"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               TextColor="White" />
                    </Border>

                    <!-- To Station -->
                    <VerticalStackLayout Spacing="8">
                        <Label Text="To" 
                               FontSize="12"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />
                        
                        <Border Padding="12,10"
                                Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
                                StrokeThickness="1"
                                BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}"
                                IsVisible="{Binding ToArea, Converter={StaticResource IsNullConverter}}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>
                            <Entry x:Name="To"
                                   Placeholder="Search for a station..."
                                   TextChanged="To_TextChanged"
                                   Focused="To_Focused"
                                   FontSize="15"
                                   BackgroundColor="Transparent" />
                        </Border>

                        <Border Padding="12"
                                Stroke="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                StrokeThickness="2"
                                BackgroundColor="{AppThemeBinding Light=#F5F3FF, Dark=#1A1625}"
                                IsVisible="{Binding ToArea, Converter={StaticResource IsNotNullConverter}}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>
                            <Grid ColumnDefinitions="*, Auto">
                                <VerticalStackLayout Grid.Column="0" Spacing="2">
                                    <Label Text="{Binding ToArea.Name}" 
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                                    <Label Text="Arrival station" 
                                           FontSize="11"
                                           TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                                </VerticalStackLayout>
                                <Button Grid.Column="1"
                                        Text="✕"
                                        FontSize="18"
                                        Clicked="RemoveTo_Clicked"
                                        WidthRequest="36"
                                        HeightRequest="36"
                                        Padding="0"
                                        CornerRadius="18"
                                        BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                                        TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}" />
                            </Grid>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Separator -->
                    <BoxView HeightRequest="1" 
                             Color="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" />

                    <!-- Time Selection -->
                    <VerticalStackLayout Spacing="12">
                        <Label Text="When" 
                               FontSize="12"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />

                        <Grid ColumnDefinitions="*, Auto" ColumnSpacing="12">
                            <Border Grid.Column="0"
                                    Padding="12,10"
                                    Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
                                    StrokeThickness="1"
                                    BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8" />
                                </Border.StrokeShape>
                                <TimePicker x:Name="TimePicker"
                                            Time="{Binding SelectedTime, Mode=TwoWay}"
                                            Format="HH:mm"
                                            FontSize="16"
                                            TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                            </Border>

                            <Button Grid.Column="1"
                                    Text="Now"
                                    Command="{Binding SetTimeToNowCommand}"
                                    FontSize="13"
                                    Padding="16,8"
                                    CornerRadius="8" />
                        </Grid>

                        <HorizontalStackLayout Spacing="16">
                            <RadioButton IsChecked="{Binding IsDeparture, Mode=TwoWay}" 
                                         Content="Departure"
                                         FontSize="14" />
                            <RadioButton IsChecked="{Binding IsArrival, Mode=TwoWay}" 
                                         Content="Arrival"
                                         FontSize="14" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>

                    <!-- Find Route Button -->
                    <Button x:Name="FindRoute"
                            Text="🔍 Find Route"
                            Clicked="FindRoute_Clicked"
                            FontSize="16"
                            FontAttributes="Bold"
                            HeightRequest="50"
                            CornerRadius="25"
                            Margin="0,8,0,0" />
                </VerticalStackLayout>
            </Border>

            <!-- Suggestions Card -->
            <Border Padding="0"
                    Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    StrokeThickness="1"
                    BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}"
                    IsVisible="{Binding Suggestions.Count}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="Black" Offset="0,2" Radius="8" Opacity="{AppThemeBinding Light=0.08, Dark=0}" />
                </Border.Shadow>

                <VerticalStackLayout>
                    <Label Text="Suggestions" 
                           FontSize="14"
                           FontAttributes="Bold"
                           Padding="16,12,16,8"
                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}" />
                    
                    <CollectionView x:Name="Suggestions"
                                    ItemsSource="{Binding Suggestions}"
                                    MaximumHeightRequest="300">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Location">
                                <VerticalStackLayout Spacing="0">
                                    <Border Padding="16,12"
                                            BackgroundColor="Transparent">
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="SuggestionTapped" 
                                                                  CommandParameter="{Binding .}" />
                                        </Border.GestureRecognizers>
                                        <VerticalStackLayout Spacing="2">
                                            <Label Text="{Binding Name}" 
                                                   FontSize="15"
                                                   FontAttributes="Bold"
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                                            <Label Text="{Binding Id}" 
                                                   FontSize="12"
                                                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                                        </VerticalStackLayout>
                                    </Border>
                                    <BoxView HeightRequest="1" 
                                             Color="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray700}}" 
                                             Margin="16,0" />
                                </VerticalStackLayout>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
